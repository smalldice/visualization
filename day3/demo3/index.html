<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vector3</title>
  <style>
    canvas {
      display: block;
      margin: 0 auto;
      background-color: #eee;
      margin-bottom: 20px;
    }
  </style>
  <script src="../vector.js"></script>
</head>

<body>
  <canvas id="demo1" width="600" height="400"></canvas>
</body>

<script>
  function regularShape(edges = 3, x, y, step) {
    if (edges < 3) {
      throw new Error('多边形边数必须大于等于3')
    }

    const ret = []
    // 多边形内角和 t = (n - 2) * Math.PI
    // 每个角的度数 = t / n
    const delta = (edges - 2) * Math.PI / edges
    const base = new Vector2D(step, 0)
    let p = new Vector2D(x, y)
    ret.push(p)
    for (let i = 0; i < edges; i++) {
      // 这里旋转外角
      p = p.copy().add(base.rotate(Math.PI - delta))
      ret.push(p)
    }

    return ret
  }

  function initCanvas() {
    const canvas = document.getElementById('demo1')
    const ctx = canvas.getContext('2d')


    ctx.translate(canvas.width / 2, canvas.height / 2)
    ctx.scale(1, -1)
    drawAxis(ctx, canvas, 'x')
    drawAxis(ctx, canvas, 'y')

    return {
      ctx, canvas
    }
  }

  function drawAxis(ctx, canvas, direction = 'x') {
    const { width, height } = canvas
    const gap = 2
    const steps = 30
    const singleDash = (height - (steps - 1) * gap) / steps

    const p0 = direction === 'x' ? new Vector2D(...[-width / 2, 0]) : new Vector2D(...[0, -height / 2])

    ctx.save()
    ctx.lineWidth = '0.5px'
    ctx.strokeStyle = 'rgba(0,0,0,0.3)'
    ctx.moveTo(...p0)
    const oneStep = direction === 'x' ? new Vector2D(...[singleDash, 0]) : new Vector2D(...[0, singleDash])
    const gapStep = direction === 'x' ? new Vector2D(...[gap, 0]) : new Vector2D(...[0, gap])

    let pNext = p0.copy()

    for (let i = 0; i < steps; i++) {
      pNext.add(oneStep)
      ctx.lineTo(...pNext.add(oneStep))
      pNext.add(gapStep)
      ctx.moveTo(...pNext)
    }

    ctx.stroke()
    ctx.restore()
  }

  function draw() {
    const { ctx, canvas } = initCanvas()
    // const p0 = [0, -canvas.height / 2]
    const p0 = [0, 0]
    const points = regularShape(100, ...p0, 1)

    ctx.save()
    ctx.beginPath()
    ctx.moveTo(...points[0])

    for (let i = 1; i < points.length; i++) {
      ctx.lineTo(...points[i])
      ctx.stroke()
    }

    ctx.closePath()
    ctx.restore()
  }

  draw()
</script>

</html>